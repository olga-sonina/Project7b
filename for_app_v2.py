import urllib.request
import json
import os
import ssl
import streamlit as st
import pandas as pd
import numpy as np
import altair as alt
import requests
import ast
#import matplotlib.pyplot as plt


#Main page interface
st.title('Home Credit App')



# GitHub raw CSV file URL
csv_url = 'https://raw.githubusercontent.com/olga-sonina/Project7/c4697ffb89de47c603d0165a67270c2710a75060/cleaned1000.csv'

# Function to fetch and load CSV data
@st.cache
def load_data():
    try:
        # Fetch CSV data from URL
        return pd.read_csv(csv_url)
    except Exception as e:
        st.error(f"Error: {e}")
        return None

# Load CSV data
df = load_data()

# Drop the 'Unnamed: 0' column
df = df.drop(columns="Unnamed: 0")

# Display the DataFrame in Streamlit app
if df is not None:
    st.dataframe(df.head())


#fig, ax = plt.subplots()
#ax.hist(df['TARGET'], bins=20)

#st.pyplot(fig)
#json_data={"index":{"13":13.0,"22":22.0,"25":25.0,"32":32.0,"35":35.0,"40":40.0,"51":51.0,"93":93.0,"104":104.0,"119":119.0},"TARGET":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":1.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"CODE_GENDER":{"13":0.0,"22":1.0,"25":1.0,"32":1.0,"35":1.0,"40":0.0,"51":0.0,"93":1.0,"104":1.0,"119":1.0},"FLAG_OWN_CAR":{"13":1.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":1.0,"93":1.0,"104":0.0,"119":0.0},"FLAG_OWN_REALTY":{"13":1.0,"22":1.0,"25":0.0,"32":1.0,"35":1.0,"40":0.0,"51":0.0,"93":1.0,"104":1.0,"119":1.0},"CNT_CHILDREN":{"13":1.0,"22":1.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":1.0,"93":1.0,"104":0.0,"119":1.0},"AMT_INCOME_TOTAL":{"13":225000.0,"22":450000.0,"25":90000.0,"32":90000.0,"35":112500.0,"40":202500.0,"51":540000.0,"93":112500.0,"104":103500.0,"119":157500.0},"AMT_CREDIT":{"13":918468.0,"22":497520.0,"25":225000.0,"32":199008.0,"35":450000.0,"40":1193580.0,"51":675000.0,"93":862560.0,"104":675000.0,"119":302341.5},"AMT_ANNUITY":{"13":28966.5,"22":32521.5,"25":11074.5,"32":20893.5,"35":44509.5,"40":35028.0,"51":34596.0,"93":27954.0,"104":19737.0,"119":24016.5},"AMT_GOODS_PRICE":{"13":697500.0,"22":450000.0,"25":225000.0,"32":180000.0,"35":450000.0,"40":855000.0,"51":675000.0,"93":720000.0,"104":675000.0,"119":261000.0},"REGION_POPULATION_RELATIVE":{"13":0.016612,"22":0.020713,"25":0.028663,"32":0.010032,"35":0.008575,"40":0.025164,"51":0.026392,"93":0.0228,"104":0.020246,"119":0.010276},"DAYS_BIRTH":{"13":-14086.0,"22":-11146.0,"25":-19334.0,"32":-12974.0,"35":-12158.0,"40":-17482.0,"51":-18632.0,"93":-10485.0,"104":-23719.0,"119":-13286.0},"DAYS_EMPLOYED":{"13":-3028.0,"22":-4306.0,"25":-3494.0,"32":-4404.0,"35":-1275.0,"40":-1262.0,"51":-6977.0,"93":-1249.0,"104":-8466.0,"119":-2305.0},"DAYS_REGISTRATION":{"13":-643.0,"22":-114.0,"25":-2419.0,"32":-7123.0,"35":-6265.0,"40":-1182.0,"51":-3904.0,"93":-4628.0,"104":-3917.0,"119":-6685.0},"DAYS_ID_PUBLISH":{"13":-4911.0,"22":-2518.0,"25":-2893.0,"32":-4464.0,"35":-2009.0,"40":-1029.0,"51":-1937.0,"93":-3110.0,"104":-4036.0,"119":-4955.0},"FLAG_MOBIL":{"13":1.0,"22":1.0,"25":1.0,"32":1.0,"35":1.0,"40":1.0,"51":1.0,"93":1.0,"104":1.0,"119":1.0},"FLAG_EMP_PHONE":{"13":1.0,"22":1.0,"25":1.0,"32":1.0,"35":1.0,"40":1.0,"51":1.0,"93":1.0,"104":1.0,"119":1.0},"FLAG_WORK_PHONE":{"13":0.0,"22":0.0,"25":0.0,"32":1.0,"35":1.0,"40":0.0,"51":0.0,"93":0.0,"104":1.0,"119":0.0},"FLAG_CONT_MOBILE":{"13":1.0,"22":1.0,"25":1.0,"32":1.0,"35":1.0,"40":1.0,"51":1.0,"93":1.0,"104":1.0,"119":1.0},"FLAG_PHONE":{"13":0.0,"22":0.0,"25":1.0,"32":0.0,"35":1.0,"40":0.0,"51":1.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_EMAIL":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":1.0},"CNT_FAM_MEMBERS":{"13":3.0,"22":3.0,"25":2.0,"32":2.0,"35":2.0,"40":2.0,"51":3.0,"93":3.0,"104":1.0,"119":3.0},"REGION_RATING_CLIENT":{"13":2.0,"22":3.0,"25":2.0,"32":2.0,"35":2.0,"40":2.0,"51":2.0,"93":2.0,"104":3.0,"119":2.0},"REGION_RATING_CLIENT_W_CITY":{"13":2.0,"22":2.0,"25":2.0,"32":2.0,"35":2.0,"40":2.0,"51":2.0,"93":2.0,"104":3.0,"119":2.0},"HOUR_APPR_PROCESS_START":{"13":13.0,"22":6.0,"25":8.0,"32":11.0,"35":19.0,"40":9.0,"51":10.0,"93":11.0,"104":16.0,"119":10.0},"REG_REGION_NOT_LIVE_REGION":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"REG_REGION_NOT_WORK_REGION":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"LIVE_REGION_NOT_WORK_REGION":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"REG_CITY_NOT_LIVE_CITY":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":1.0},"REG_CITY_NOT_WORK_CITY":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":1.0},"LIVE_CITY_NOT_WORK_CITY":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"EXT_SOURCE_2":{"13":0.5669066132,"22":0.4571429716,"25":0.6514056365,"32":0.5594667916,"35":0.6631580756,"40":0.306840586,"51":0.7133545849,"93":0.608604106,"104":0.3993660764,"119":0.6014083651},"EXT_SOURCE_3":{"13":0.77008707,"22":0.3589512286,"25":0.4614823913,"32":0.7981372313,"35":0.6785676887,"40":0.3201633669,"51":0.3092753559,"93":0.2288834167,"104":0.6738300779,"119":0.0963186928},"YEARS_BEGINEXPLUATATION_AVG":{"13":0.9806,"22":0.9786,"25":0.9781,"32":0.9801,"35":0.9861,"40":0.996,"51":0.9811,"93":0.9876,"104":0.9732,"119":0.9866},"FLOORSMAX_AVG":{"13":0.3333,"22":0.1667,"25":0.1667,"32":0.1667,"35":0.1667,"40":0.25,"51":0.4583,"93":0.3333,"104":0.1667,"119":0.1667},"LIVINGAREA_AVG":{"13":0.1397,"22":0.0873,"25":0.067,"32":0.0602,"35":0.0582,"40":0.1267,"51":0.5878,"93":0.2675,"104":0.0308,"119":0.0898},"YEARS_BEGINEXPLUATATION_MODE":{"13":0.9806,"22":0.9786,"25":0.9782,"32":0.9801,"35":0.9861,"40":0.996,"51":0.9811,"93":0.9876,"104":0.9732,"119":0.9866},"FLOORSMAX_MODE":{"13":0.3333,"22":0.1667,"25":0.1667,"32":0.1667,"35":0.1667,"40":0.25,"51":0.4583,"93":0.3333,"104":0.1667,"119":0.1667},"LIVINGAREA_MODE":{"13":0.1456,"22":0.091,"25":0.0698,"32":0.0627,"35":0.0606,"40":0.132,"51":0.6124,"93":0.2787,"104":0.0321,"119":0.0936},"YEARS_BEGINEXPLUATATION_MEDI":{"13":0.9806,"22":0.9786,"25":0.9781,"32":0.9801,"35":0.9861,"40":0.996,"51":0.9811,"93":0.9876,"104":0.9732,"119":0.9866},"FLOORSMAX_MEDI":{"13":0.3333,"22":0.1667,"25":0.1667,"32":0.1667,"35":0.1667,"40":0.25,"51":0.4583,"93":0.3333,"104":0.1667,"119":0.1667},"LIVINGAREA_MEDI":{"13":0.1422,"22":0.0889,"25":0.0682,"32":0.0613,"35":0.0592,"40":0.129,"51":0.5983,"93":0.2723,"104":0.0313,"119":0.0915},"TOTALAREA_MODE":{"13":0.1417,"22":0.0696,"25":0.0533,"32":0.0684,"35":0.0749,"40":0.1463,"51":0.5149,"93":0.2576,"104":0.0396,"119":0.086},"OBS_30_CNT_SOCIAL_CIRCLE":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":2.0,"93":1.0,"104":0.0,"119":6.0},"DEF_30_CNT_SOCIAL_CIRCLE":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"OBS_60_CNT_SOCIAL_CIRCLE":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":2.0,"93":1.0,"104":0.0,"119":6.0},"DEF_60_CNT_SOCIAL_CIRCLE":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"DAYS_LAST_PHONE_CHANGE":{"13":-4.0,"22":-468.0,"25":0.0,"32":-2766.0,"35":-1285.0,"40":-1075.0,"51":-1285.0,"93":-1234.0,"104":-1689.0,"119":-1868.0},"FLAG_DOCUMENT_2":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_3":{"13":1.0,"22":1.0,"25":1.0,"32":1.0,"35":1.0,"40":1.0,"51":1.0,"93":1.0,"104":1.0,"119":1.0},"FLAG_DOCUMENT_4":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_5":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_6":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_7":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_8":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_9":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_10":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_11":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_12":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_13":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_14":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_15":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_16":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_17":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_18":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_19":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_20":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"FLAG_DOCUMENT_21":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"AMT_REQ_CREDIT_BUREAU_HOUR":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"AMT_REQ_CREDIT_BUREAU_DAY":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"AMT_REQ_CREDIT_BUREAU_WEEK":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":1.0,"93":0.0,"104":0.0,"119":1.0},"AMT_REQ_CREDIT_BUREAU_MON":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":2.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"AMT_REQ_CREDIT_BUREAU_QRT":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"AMT_REQ_CREDIT_BUREAU_YEAR":{"13":1.0,"22":5.0,"25":0.0,"32":2.0,"35":0.0,"40":4.0,"51":3.0,"93":0.0,"104":2.0,"119":3.0},"DAYS_EMPLOYED_PERC":{"13":0.2149652137,"22":0.3863269334,"25":0.1807179063,"32":0.339448127,"35":0.1048692219,"40":0.0721885368,"51":0.374463289,"93":0.119122556,"104":0.3569290442,"119":0.1734908927},"INCOME_CREDIT_PERC":{"13":0.2449731509,"22":0.9044862518,"25":0.4,"32":0.4522431259,"35":0.25,"40":0.1696576685,"51":0.8,"93":0.1304257095,"104":0.1533333333,"119":0.5209341093},"INCOME_PER_PERSON":{"13":75000.0,"22":150000.0,"25":45000.0,"32":45000.0,"35":56250.0,"40":101250.0,"51":180000.0,"93":37500.0,"104":103500.0,"119":52500.0},"ANNUITY_INCOME_PERC":{"13":0.12874,"22":0.07227,"25":0.12305,"32":0.23215,"35":0.39564,"40":0.1729777778,"51":0.0640666667,"93":0.24848,"104":0.1906956522,"119":0.1524857143},"PAYMENT_RATE":{"13":0.0315378435,"22":0.0653672214,"25":0.04922,"32":0.1049882417,"35":0.09891,"40":0.0293470065,"51":0.0512533333,"93":0.0324081803,"104":0.02924,"119":0.0794350097},"BURO_DAYS_CREDIT_MIN":{"13":-2881.0,"22":-1644.0,"25":-1547.0,"32":-2761.0,"35":-2890.0,"40":-2055.0,"51":-1343.0,"93":-2257.0,"104":-2508.0,"119":-1252.0},"BURO_DAYS_CREDIT_MAX":{"13":-909.0,"22":-148.0,"25":-418.0,"32":-1247.0,"35":-66.0,"40":-420.0,"51":-194.0,"93":-270.0,"104":-62.0,"119":-215.0},"BURO_DAYS_CREDIT_MEAN":{"13":-1944.3333333333,"22":-679.0,"25":-930.8333333333,"32":-1812.875,"35":-1292.5384615385,"40":-1104.8,"51":-639.4,"93":-859.4166666667,"104":-1618.8333333333,"119":-733.5},"BURO_DAYS_CREDIT_VAR":{"13":538712.6666666667,"22":700771.0,"25":199461.3666666667,"32":270968.4107142857,"35":866597.7692307691,"40":361218.7,"51":195557.3,"93":495906.8106060606,"104":1149658.9666666666,"119":537684.5},"BURO_DAYS_CREDIT_ENDDATE_MIN":{"13":-2546.0,"22":217.0,"25":-1173.0,"32":-2608.0,"35":-2678.0,"40":-960.0,"51":-612.0,"93":-1890.0,"104":-2353.0,"119":-29.0},"BURO_DAYS_CREDIT_ENDDATE_MAX":{"13":197.0,"22":1581.0,"25":1409.0,"32":-1063.0,"35":117.0,"40":4284.0,"51":638.0,"93":9233.0,"104":1366.0,"119":-29.0},"BURO_DAYS_CREDIT_ENDDATE_MEAN":{"13":-1512.3333333333,"22":899.0,"25":-61.6,"32":-1696.4285714286,"35":-969.1538461538,"40":1301.0,"51":-154.4,"93":696.0,"104":-1007.5,"119":-29.0},"BURO_DAYS_CREDIT_UPDATE_MEAN":{"13":-1594.3333333333,"22":-314.6666666667,"25":-411.1666666667,"32":-1544.625,"35":-992.8461538462,"40":-444.6,"51":-306.6,"93":-474.9166666667,"104":-1231.0,"119":-20.0},"BURO_CREDIT_DAY_OVERDUE_MAX":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"BURO_CREDIT_DAY_OVERDUE_MEAN":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"BURO_AMT_CREDIT_MAX_OVERDUE_MEAN":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":769.365,"40":6759.3375,"51":8543.97,"93":4774.0,"104":0.0,"119":668.25},"BURO_AMT_CREDIT_SUM_MAX":{"13":315000.0,"22":2700000.0,"25":508500.0,"32":108000.0,"35":180000.0,"40":4045500.0,"51":1624500.0,"93":900000.0,"104":461842.11,"119":337500.0},"BURO_AMT_CREDIT_SUM_MEAN":{"13":143295.0,"22":1875000.0,"25":107238.495,"32":74016.5625,"35":63254.2430769231,"40":1905526.8,"51":431493.84,"93":208818.47625,"104":203962.185,"119":189627.75},"BURO_AMT_CREDIT_SUM_SUM":{"13":859770.0,"22":5625000.0,"25":643430.97,"32":592132.5,"35":822305.16,"40":9527634.0,"51":2157469.2000000002,"93":2505821.7149999999,"104":1223773.1100000001,"119":379255.5},"BURO_AMT_CREDIT_SUM_DEBT_MAX":{"13":0.0,"22":2542576.5,"25":432301.5,"32":0.0,"35":0.0,"40":2528203.5,"51":980784.0,"93":62406.81,"104":390329.955,"119":334089.0},"BURO_AMT_CREDIT_SUM_DEBT_MEAN":{"13":0.0,"22":1738907.1899999999,"25":75273.75,"32":0.0,"35":0.0,"40":805114.125,"51":196156.8,"93":13009.03875,"104":87881.2425,"119":167044.5},"BURO_AMT_CREDIT_SUM_DEBT_SUM":{"13":0.0,"22":3477814.3799999999,"25":451642.5,"32":0.0,"35":0.0,"40":3220456.5,"51":980784.0,"93":104072.31,"104":527287.4550000001,"119":334089.0},"BURO_AMT_CREDIT_SUM_OVERDUE_MEAN":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"BURO_AMT_CREDIT_SUM_LIMIT_MEAN":{"13":0.0,"22":0.0,"25":4276.005,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":8190.6428571429,"104":0.0,"119":0.0},"BURO_AMT_CREDIT_SUM_LIMIT_SUM":{"13":0.0,"22":0.0,"25":25656.03,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":57334.5,"104":0.0,"119":0.0},"BURO_CNT_CREDIT_PROLONG_SUM":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":1.0,"104":0.0,"119":0.0},"BURO_MONTHS_BALANCE_SIZE_SUM":{"13":0.0,"22":0.0,"25":0.0,"32":421.0,"35":0.0,"40":0.0,"51":65.0,"93":0.0,"104":0.0,"119":16.0},"PREV_AMT_ANNUITY_MIN":{"13":11783.52,"22":23608.485,"25":2826.45,"32":5305.995,"35":3268.485,"40":4586.895,"51":4500.0,"93":5292.45,"104":4674.78,"119":2958.3},"PREV_AMT_ANNUITY_MAX":{"13":16967.295,"22":42778.845,"25":9035.685,"32":25595.82,"35":7297.515,"40":31674.87,"51":145794.6,"93":14997.015,"104":20035.845,"119":19138.095},"PREV_AMT_ANNUITY_MEAN":{"13":14375.4075,"22":33193.665,"25":4731.04125,"32":17011.764,"35":5283.0,"40":16749.915,"51":25907.2026923077,"93":10262.19,"104":11173.55625,"119":10411.1357142857},"PREV_AMT_APPLICATION_MIN":{"13":158040.0,"22":0.0,"25":17055.0,"32":38385.0,"35":15516.0,"40":0.0,"51":0.0,"93":44991.0,"104":67500.0,"119":0.0},"PREV_AMT_APPLICATION_MAX":{"13":195291.0,"22":675000.0,"25":47241.0,"32":157500.0,"35":58486.5,"40":675000.0,"51":1305000.0,"93":149985.0,"104":342000.0,"119":314100.0},"PREV_AMT_APPLICATION_MEAN":{"13":176665.5,"22":269115.0,"25":33497.26875,"32":130142.7,"35":37001.25,"40":242617.5,"51":186235.56,"93":90984.6825,"104":168971.625,"119":62860.0909090909},"PREV_AMT_CREDIT_MIN":{"13":152721.0,"22":0.0,"25":15349.5,"32":45720.0,"35":16285.5,"40":34384.5,"51":0.0,"93":45351.0,"104":76410.0,"119":0.0},"PREV_AMT_CREDIT_MAX":{"13":198409.5,"22":744498.0,"25":49734.0,"32":188640.0,"35":64278.0,"40":744498.0,"51":1305000.0,"93":144513.0,"104":373599.0,"119":282690.0},"PREV_AMT_CREDIT_MEAN":{"13":175565.25,"22":292281.0,"25":32534.64375,"32":140661.0,"35":40281.75,"40":338818.5,"51":225695.225,"93":91563.75,"104":190147.5,"119":77539.0909090909},"PREV_APP_CREDIT_PERC_MIN":{"13":0.9842825066,"22":0.9066511932,"25":0.9498733261,"32":0.8157204198,"35":0.9098991879,"40":0.0,"51":0.1052631579,"93":0.9044964813,"104":0.8347245409,"119":0.0},"PREV_APP_CREDIT_PERC_MAX":{"13":1.0348282162,"22":1.0,"25":1.2005795235,"32":1.0187650011,"35":0.9527493783,"40":1.1111111111,"51":1.5330433101,"93":1.1111111111,"104":0.9154200092,"119":1.1111111111},"PREV_APP_CREDIT_PERC_MEAN":{"13":1.0095553614,"22":0.9533255966,"25":1.0403155152,"32":0.9190061122,"35":0.9313242831,"40":0.7841142625,"51":1.0025570495,"93":0.9924382594,"104":0.8858583622,"119":0.9002925729},"PREV_APP_CREDIT_PERC_VAR":{"13":0.0012774344,"22":0.0043569999,"25":0.0054797979,"32":0.0083735632,"35":0.0009180694,"40":0.1678873614,"51":0.0865966161,"93":0.0058049809,"104":0.0013574936,"119":0.1086918165},"PREV_AMT_DOWN_PAYMENT_MIN":{"13":15804.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":3820.5,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"PREV_AMT_DOWN_PAYMENT_MAX":{"13":22500.0,"22":0.0,"25":6714.0,"32":8824.5,"35":0.0,"40":3820.5,"51":28341.0,"93":14998.5,"104":0.0,"119":31410.0},"PREV_AMT_DOWN_PAYMENT_MEAN":{"13":19152.0,"22":0.0,"25":1262.625,"32":2689.875,"35":0.0,"40":3820.5,"51":6202.67,"93":5589.6825,"104":0.0,"119":5900.1428571429},"PREV_AMT_GOODS_PRICE_MIN":{"13":158040.0,"22":132345.0,"25":17055.0,"32":38385.0,"35":15516.0,"40":38205.0,"51":35680.05,"93":44991.0,"104":67500.0,"119":14805.0},"PREV_AMT_GOODS_PRICE_MAX":{"13":195291.0,"22":675000.0,"25":47241.0,"32":157500.0,"35":58486.5,"40":675000.0,"51":1305000.0,"93":149985.0,"104":342000.0,"119":314100.0},"PREV_AMT_GOODS_PRICE_MEAN":{"13":176665.5,"22":403672.5,"25":33497.26875,"32":130142.7,"35":37001.25,"40":291141.0,"51":239445.72,"93":90984.6825,"104":168971.625,"119":76829.0},"PREV_HOUR_APPR_PROCESS_START_MIN":{"13":15.0,"22":6.0,"25":7.0,"32":5.0,"35":12.0,"40":11.0,"51":12.0,"93":13.0,"104":13.0,"119":10.0},"PREV_HOUR_APPR_PROCESS_START_MAX":{"13":18.0,"22":12.0,"25":16.0,"32":11.0,"35":14.0,"40":15.0,"51":19.0,"93":18.0,"104":13.0,"119":17.0},"PREV_HOUR_APPR_PROCESS_START_MEAN":{"13":16.5,"22":8.3333333333,"25":12.5,"32":7.4,"35":13.0,"40":12.8333333333,"51":15.8888888889,"93":15.6666666667,"104":13.0,"119":13.1818181818},"PREV_RATE_DOWN_PAYMENT_MIN":{"13":0.1021331715,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.1089090909,"51":0.0,"93":0.0,"104":0.0,"119":0.0},"PREV_RATE_DOWN_PAYMENT_MAX":{"13":0.1109257205,"22":0.0,"25":0.2109194751,"32":0.0627374206,"35":0.0,"40":0.1089090909,"51":0.3998890124,"93":0.1089090909,"104":0.0,"119":0.1089090909},"PREV_RATE_DOWN_PAYMENT_MEAN":{"13":0.106529446,"22":0.0,"25":0.0448038957,"32":0.0267398106,"35":0.0,"40":0.1089090909,"51":0.088030641,"93":0.0639763655,"104":0.0,"119":0.0605151205},"PREV_DAYS_DECISION_MIN":{"13":-2441.0,"22":-1427.0,"25":-2856.0,"32":-2612.0,"35":-2701.0,"40":-2634.0,"51":-2808.0,"93":-2233.0,"104":-1689.0,"119":-2592.0},"PREV_DAYS_DECISION_MAX":{"13":-612.0,"22":-152.0,"25":-378.0,"32":-539.0,"35":-1508.0,"40":-1072.0,"51":-213.0,"93":-621.0,"104":-846.0,"119":-217.0},"PREV_DAYS_DECISION_MEAN":{"13":-1526.5,"22":-682.3333333333,"25":-1981.0833333333,"32":-1186.2,"35":-2104.5,"40":-1432.0,"51":-1106.5,"93":-1482.3333333333,"104":-1084.5,"119":-1655.0},"PREV_CNT_PAYMENT_MEAN":{"13":17.0,"22":21.0,"25":8.625,"32":10.8,"35":9.0,"40":23.6666666667,"51":12.4615384615,"93":11.0,"104":24.0,"119":12.0},"PREV_CNT_PAYMENT_SUM":{"13":34.0,"22":42.0,"25":69.0,"32":54.0,"35":18.0,"40":142.0,"51":162.0,"93":66.0,"104":96.0,"119":84.0},"POS_MONTHS_BALANCE_MAX":{"13":-1.0,"22":-12.0,"25":-7.0,"32":-7.0,"35":-36.0,"40":-38.0,"51":-2.0,"93":-17.0,"104":-5.0,"119":-1.0},"POS_MONTHS_BALANCE_MEAN":{"13":-33.3870967742,"22":-32.9090909091,"25":-55.2142857143,"32":-43.5,"35":-56.6666666667,"40":-62.0,"51":-25.4583333333,"93":-44.0810810811,"104":-24.935483871,"119":-39.4571428571},"POS_MONTHS_BALANCE_SIZE":{"13":31.0,"22":11.0,"25":14.0,"32":26.0,"35":21.0,"40":22.0,"51":24.0,"93":37.0,"104":62.0,"119":35.0},"POS_SK_DPD_MAX":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":25.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":26.0},"POS_SK_DPD_MEAN":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":1.1904761905,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.7428571429},"POS_SK_DPD_DEF_MAX":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":26.0},"POS_SK_DPD_DEF_MEAN":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0,"40":0.0,"51":0.0,"93":0.0,"104":0.0,"119":0.7428571429},"POS_COUNT":{"13":31.0,"22":11.0,"25":14.0,"32":26.0,"35":21.0,"40":22.0,"51":24.0,"93":37.0,"104":62.0,"119":35.0},"INSTAL_NUM_INSTALMENT_VERSION_NUNIQUE":{"13":1.0,"22":2.0,"25":2.0,"32":2.0,"35":1.0,"40":2.0,"51":2.0,"93":2.0,"104":2.0,"119":3.0},"INSTAL_DPD_MAX":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":46.0,"40":0.0,"51":0.0,"93":6.0,"104":0.0,"119":29.0},"INSTAL_DPD_MEAN":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":5.1,"40":0.0,"51":0.0,"93":0.3529411765,"104":0.0,"119":1.4097222222},"INSTAL_DPD_SUM":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":102.0,"40":0.0,"51":0.0,"93":12.0,"104":0.0,"119":203.0},"INSTAL_DBD_MAX":{"13":24.0,"22":17.0,"25":35.0,"32":63.0,"35":196.0,"40":11.0,"51":31.0,"93":85.0,"104":31.0,"119":36.0},"INSTAL_DBD_MEAN":{"13":10.8666666667,"22":9.375,"25":21.8333333333,"32":18.3181818182,"35":39.9,"40":4.1,"51":14.3684210526,"93":16.3529411765,"104":10.5254237288,"119":5.7291666667},"INSTAL_DBD_SUM":{"13":326.0,"22":75.0,"25":131.0,"32":403.0,"35":798.0,"40":82.0,"51":273.0,"93":556.0,"104":621.0,"119":825.0},"INSTAL_PAYMENT_PERC_MAX":{"13":1.0,"22":1.0,"25":1.0,"32":1.0,"35":1.0,"40":1.0,"51":1.0,"93":1.0,"104":1.0,"119":1.0},"INSTAL_PAYMENT_PERC_MEAN":{"13":1.0,"22":1.0,"25":1.0,"32":1.0,"35":0.9,"40":1.0,"51":1.0,"93":0.9411764706,"104":1.0,"119":0.9583333333},"INSTAL_PAYMENT_PERC_SUM":{"13":30.0,"22":8.0,"25":6.0,"32":22.0,"35":18.0,"40":20.0,"51":19.0,"93":32.0,"104":59.0,"119":138.0},"INSTAL_PAYMENT_PERC_VAR":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":0.0810272233,"40":0.0,"51":0.0,"93":0.0284033439,"104":0.0,"119":0.0304317329},"INSTAL_PAYMENT_DIFF_MAX":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":7176.285,"40":0.0,"51":0.0,"93":8400.825,"104":0.0,"119":17457.795},"INSTAL_PAYMENT_DIFF_MEAN":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":730.20825,"40":0.0,"51":0.0,"93":576.9833823529,"104":0.0,"119":360.1590625},"INSTAL_PAYMENT_DIFF_SUM":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":14604.165,"40":0.0,"51":0.0,"93":19617.435,"104":0.0,"119":51862.905},"INSTAL_PAYMENT_DIFF_VAR":{"13":0.0,"22":0.0,"25":0.0,"32":0.0,"35":4321074.992695462,"40":0.0,"51":0.0,"93":3317464.8772526071,"104":0.0,"119":3314578.8553622267},"INSTAL_AMT_INSTALMENT_MAX":{"13":16967.295,"22":770004.3149999999,"25":17846.145,"32":35172.135,"35":7306.65,"40":122628.285,"51":416819.61,"93":116659.62,"104":20035.845,"119":264667.5},"INSTAL_AMT_INSTALMENT_MEAN":{"13":13508.9205,"22":119294.595,"25":11820.645,"32":19217.5690909091,"35":6089.499,"40":13427.379,"51":68871.6284210526,"93":15324.8585294118,"104":12219.2862711864,"119":13152.8740625},"INSTAL_AMT_INSTALMENT_SUM":{"13":405267.615,"22":954356.76,"25":70923.87,"32":422786.52,"35":121789.98,"40":268547.58,"51":1308560.9399999999,"93":521045.19,"104":720937.89,"119":1894013.865},"INSTAL_AMT_PAYMENT_MIN":{"13":11783.52,"22":23531.175,"25":9035.685,"32":5305.995,"35":130.365,"40":4577.94,"51":5621.355,"93":1897.65,"104":4674.78,"119":140.4},"INSTAL_AMT_PAYMENT_MAX":{"13":16967.295,"22":770004.3149999999,"25":17846.145,"32":35172.135,"35":7297.515,"40":122628.285,"51":416819.61,"93":116659.62,"104":20035.845,"119":264667.5},"INSTAL_AMT_PAYMENT_MEAN":{"13":13508.9205,"22":119294.595,"25":11820.645,"32":19217.5690909091,"35":5359.29075,"40":13427.379,"51":68871.6284210526,"93":14747.8751470588,"104":12219.2862711864,"119":12792.715},"INSTAL_AMT_PAYMENT_SUM":{"13":405267.615,"22":954356.76,"25":70923.87,"32":422786.52,"35":107185.815,"40":268547.58,"51":1308560.9399999999,"93":501427.755,"104":720937.89,"119":1842150.96},"INSTAL_DAYS_ENTRY_PAYMENT_MAX":{"13":-21.0,"22":-425.0,"25":-233.0,"32":-235.0,"35":-1101.0,"40":-1172.0,"51":-70.0,"93":-508.0,"104":-164.0,"119":-15.0},"INSTAL_DAYS_ENTRY_PAYMENT_MEAN":{"13":-962.5333333333,"22":-1105.875,"25":-730.6666666667,"32":-1247.4090909091,"35":-1722.7,"40":-1888.1,"51":-704.3157894737,"93":-1389.5,"104":-740.3898305085,"119":-1159.4166666667},"INSTAL_DAYS_ENTRY_PAYMENT_SUM":{"13":-28876.0,"22":-8847.0,"25":-4384.0,"32":-27443.0,"35":-34454.0,"40":-37762.0,"51":-13382.0,"93":-47243.0,"104":-43683.0,"119":-166956.0},"INSTAL_COUNT":{"13":30.0,"22":8.0,"25":6.0,"32":22.0,"35":20.0,"40":20.0,"51":19.0,"93":34.0,"104":59.0,"119":144.0}}
#json_data = json.dumps(json_data)
#df = pd.read_json(json_data)
categorical_columns = [col for col in df.columns if df[col].dtype == 'object']
df=df.drop(columns=categorical_columns)
df=df.dropna()
#st.dataframe(df.head())
y=df['TARGET'].astype('float')
X = df.drop(columns=['TARGET','index']).astype('float')
#X_train,X_test,y_train,y_test = train_test_split(X,y,test_size=0.2)

client_list=['Client1', 'Client2', 'Client3','Client4','Client5', 'Client6']

option = st.selectbox('Choose a client',client_list)


def allowSelfSignedHttps(allowed):
    # bypass the server certificate verification on client side
    if allowed and not os.environ.get('PYTHONHTTPSVERIFY', '') and getattr(ssl, '_create_unverified_context', None):
        ssl._create_default_https_context = ssl._create_unverified_context

allowSelfSignedHttps(True) # this line is needed if you use self-signed certificate in your scoring service.

def calc_client(option):
    n_client=client_list.index(option)
    inputs=X.iloc[[n_client]].to_json(orient="split")
    # Request data goes here
    # The example below assumes JSON formatting which may be updated
    # depending on the format your endpoint expects.
    # More information can be found here:
    # https://docs.microsoft.com/azure/machine-learning/how-to-deploy-advanced-entry-script

    data = ast.literal_eval(inputs)
    body = str.encode(json.dumps(data))

    url = "http://d2b1f5a8-29cc-4b8d-8a28-165d9f2404d9.francecentral.azurecontainer.io/score"


    headers = {'Content-Type':'application/json'}



    req = urllib.request.Request(url, body, headers)

    try:
        response = urllib.request.urlopen(req)

        result = response.read()
        st.write(result.decode("utf-8") )
    except urllib.error.HTTPError as error:
        st.write("The request failed with status code: " + str(error.code))

        # Print the headers - they include the requert ID and the timestamp, which are useful for debugging the failure
        st.write(error.info())
        st.write(error.read().decode("utf8", 'ignore'))

calc_client(option)

